{% extends "base.html" %}
{% block content %}
<div class="layout">
    <div class="card">
        <h2 style="margin-top:0">XML → Schema</h2>
        <p class="muted">Upload an XML document to generate a simple XSD that reflects the document structure.</p>

        <form method="post" action="/generate_schema" enctype="multipart/form-data">
            <label class="file-label" id="xmlLabel" for="xmlfile">Choose XML file (required)</label>
            <input type="file" name="xmlfile" id="xmlfile" accept=".xml" required>
            <div style="margin-top:10px">
                <button class="btn" type="submit">Generate Schema</button>
            </div>
        </form>
        <script>
            // Update label text on file selection (label click handled natively via for="xmlfile")
            (function () {
                const label = document.getElementById('xmlLabel');
                const input = document.getElementById('xmlfile');
                if (label && input) {
                    input.addEventListener('change', () => {
                        const f = input.files[0];
                        label.textContent = f ? f.name : 'Choose XML file (required)';
                    });
                }
            })();
        </script>
    </div>

    <aside class="card">
        <h4 style="margin:0">About</h4>
        <p class="muted">The generated schema is a best-effort XSD useful for basic validation and exploration. For
            production schemas you may want to refine types and constraints manually.</p>
    </aside>
</div>

{% if schema_text %}
<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0">Generated Schema</h3>
        <button class="btn" id="copySchema">Copy</button>
    </div>
    <pre class="code-block" id="schemaBlock">{{ schema_text }}</pre>
</div>
<script>
    // Copy button only present when schema_text exists
    (function () {
        const copyBtn = document.getElementById('copySchema');
        if (!copyBtn) return;
        copyBtn.addEventListener('click', () => {
            const text = document.getElementById('schemaBlock').textContent;
            navigator.clipboard && navigator.clipboard.writeText(text).then(() => {
                copyBtn.textContent = 'Copied';
                setTimeout(() => copyBtn.textContent = 'Copy', 1200);
            }, () => { alert('Copy failed — select and copy manually.'); });
        });
    })();
</script>
{% endif %}

{% endblock %}