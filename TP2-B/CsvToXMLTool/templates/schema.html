{% extends "base.html" %}
{% block content %}
<div class="layout">
    <div class="card">
        <h2 style="margin-top:0">XML → Schema</h2>
        <p class="muted">Upload an XML document to generate a simple XSD that reflects the document structure.</p>

        <form method="post" action="/generate_schema" enctype="multipart/form-data">
            <label class="file-label" id="xmlLabel">Choose XML file (required)</label>
            <input type="file" name="xmlfile" id="xmlfile" accept=".xml" required>
            <div style="margin-top:10px">
                <button class="btn" type="submit">Generate Schema</button>
            </div>
        </form>
    </div>

    <aside class="card">
        <h4 style="margin:0">About</h4>
        <p class="muted">The generated schema is a best-effort XSD useful for basic validation and exploration. For
            production schemas you may want to refine types and constraints manually.</p>
    </aside>
</div>

{% if schema_text %}
<div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0">Generated Schema</h3>
        <button class="btn" id="copySchema">Copy</button>
    </div>
    <pre class="code-block" id="schemaBlock">{{ schema_text }}</pre>
</div>
<script>
    document.getElementById('xmlLabel').addEventListener('click', () => document.getElementById('xmlfile').click());
    document.getElementById('xmlfile').addEventListener('change', function () {
        const f = this.files[0];
        document.getElementById('xmlLabel').textContent = f ? f.name : 'Choose XML file (required)';
    });

    const copyBtn = document.getElementById('copySchema');
    copyBtn.addEventListener('click', () => {
        const text = document.getElementById('schemaBlock').textContent;
        navigator.clipboard && navigator.clipboard.writeText(text).then(() => {
            copyBtn.textContent = 'Copied';
            setTimeout(() => copyBtn.textContent = 'Copy', 1200);
        }, () => { alert('Copy failed — select and copy manually.'); });
    });
</script>
{% endif %}

{% endblock %}