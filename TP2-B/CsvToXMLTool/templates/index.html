{% extends "base.html" %}
{% block content %}
<div class="layout">
    <div class="card">
        <h2 style="margin-top:0">CSV to XML Converter</h2>
        <p class="muted">Upload a CSV file and download the generated XML. Optionally limit the number of rows.</p>

        <form id="csvForm" method="post" enctype="multipart/form-data">
            <div class="row">
                <label class="file-label" id="fileLabel">Choose CSV file (or click to select)</label>
                <input type="file" name="csvfile" id="csvfile" accept=".csv" required>

                <div class="controls">
                    <input type="number" name="max_lines" id="max_lines" value="15" placeholder="Max lines (optional)"
                        min="1">
                    <button class="btn" type="submit">Convert</button>
                    <button type="button" class="btn secondary" id="clearBtn">Clear</button>
                </div>
            </div>
        </form>
    </div>

    <aside class="card">
        <h4 style="margin:0">Notes</h4>
        <p class="muted">The first column of your CSV becomes the element name for each record and is used as the
            element's title attribute. Empty CSVs will return an empty collection element.</p>
    </aside>
</div>

<script>
    const csvInput = document.getElementById('csvfile');
    const fileLabel = document.getElementById('fileLabel');
    const form = document.getElementById('csvForm');
    const clearBtn = document.getElementById('clearBtn');

    fileLabel.addEventListener('click', () => csvInput.click());
    csvInput.addEventListener('change', () => {
        if (csvInput.files.length) {
            fileLabel.textContent = csvInput.files[0].name;
        } else {
            fileLabel.textContent = 'Choose CSV file (or click to select)';
        }
    });

    clearBtn.addEventListener('click', () => {
        csvInput.value = '';
        fileLabel.textContent = 'Choose CSV file (or click to select)';
        document.getElementById('max_lines').value = '';
    });

    form.addEventListener('submit', function (e) {
        const maxLines = document.getElementById('max_lines').value;
        if (maxLines) {
            form.action = `/convert?lines=${maxLines}`;
        } else {
            form.action = `/convert`;
        }
    });
</script>
{% endblock %}